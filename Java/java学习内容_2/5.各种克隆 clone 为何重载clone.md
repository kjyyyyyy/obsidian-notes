éå¸¸æ£’çš„é—®é¢˜ï¼ğŸ‘

ä½ é—®çš„è¿™ä¸‰ä¸ªæ¦‚å¿µï¼š

- **æµ…å…‹éš†ï¼ˆShallow Copyï¼‰**
- **æ·±å…‹éš†ï¼ˆDeep Copyï¼‰**
- **å·¥å…·ç±» `ObjectUtils` æˆ– `Objects`**

éƒ½æ˜¯ Java ä¸­ç”¨æ¥å¤„ç†å¯¹è±¡å¤åˆ¶å’Œåˆ¤æ–­çš„é‡è¦å†…å®¹ã€‚ä¸‹é¢æˆ‘ä¼šç”¨**ç®€å•æ˜“æ‡‚çš„æ–¹å¼ + ç¤ºä¾‹ä»£ç **æ¥è§£é‡Šæ¸…æ¥šå®ƒä»¬ï¼Œé€‚åˆåˆå­¦è€…ç†è§£ã€‚

---

## ğŸ§  ä¸€ã€ä»€ä¹ˆæ˜¯æµ…å…‹éš†ï¼ˆShallow Copyï¼‰

### âœ… å®šä¹‰ï¼š
æµ…å…‹éš†æ˜¯æŒ‡ï¼š**åªå¤åˆ¶å¯¹è±¡æœ¬èº«ï¼Œä¸å¤åˆ¶å®ƒå†…éƒ¨å¼•ç”¨çš„å¯¹è±¡**ã€‚  
ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœåŸå¯¹è±¡é‡Œæœ‰å…¶ä»–å¯¹è±¡å±æ€§ï¼Œé‚£ä¹ˆå…‹éš†åçš„å¯¹è±¡ä¼šå’ŒåŸå¯¹è±¡å…±äº«è¿™äº›å¯¹è±¡ã€‚

### ğŸ” ç¤ºä¾‹ï¼š

```java
class Address {
    String city;

    public Address(String city) {
        this.city = city;
    }
}

class Person implements Cloneable {
    String name;
    Address address;

    public Person(String name, Address address) {
        this.name = name;
        this.address = address;
    }

    @Override
    protected Object clone() throws CloneNotSupportedException {
        return super.clone(); // é»˜è®¤æ˜¯æµ…å…‹éš†
    }
}

public class ShallowCopyDemo {
    public static void main(String[] args) throws CloneNotSupportedException {
        Address addr = new Address("åŒ—äº¬");
        Person p1 = new Person("å¼ ä¸‰", addr);
        Person p2 = (Person) p1.clone();

        // ä¿®æ”¹åŸå§‹åœ°å€
        p1.address.city = "ä¸Šæµ·";

        System.out.println(p2.address.city); // è¾“å‡ºï¼šä¸Šæµ· â† å› ä¸ºæ˜¯åŒä¸€ä¸ª Address å¯¹è±¡
    }
}
```

### â— è¯´æ˜ï¼š
- `p1` å’Œ `p2` æ˜¯ä¸¤ä¸ªä¸åŒçš„ `Person` å¯¹è±¡ã€‚
- ä½†æ˜¯ä»–ä»¬çš„ `address` å±æ€§æŒ‡å‘çš„æ˜¯**åŒä¸€ä¸ª Address å¯¹è±¡**ï¼Œæ‰€ä»¥æ”¹äº†å…¶ä¸­ä¸€ä¸ªï¼Œå¦ä¸€ä¸ªä¹Ÿå˜äº†ã€‚

---

## ğŸ§  äºŒã€ä»€ä¹ˆæ˜¯æ·±å…‹éš†ï¼ˆDeep Copyï¼‰

### âœ… å®šä¹‰ï¼š
æ·±å…‹éš†æ˜¯æŒ‡ï¼š**ä¸ä»…å¤åˆ¶å¯¹è±¡æœ¬èº«ï¼Œè¿˜é€’å½’åœ°å¤åˆ¶å®ƒå†…éƒ¨æ‰€æœ‰çš„å¼•ç”¨å¯¹è±¡**ã€‚  
è¿™æ ·ï¼Œä¸¤ä¸ªå¯¹è±¡ä¹‹é—´å®Œå…¨ç‹¬ç«‹ï¼Œäº’ä¸å½±å“ã€‚

### ğŸ” ç¤ºä¾‹ï¼š

```java
class Address implements Cloneable {
    String city;

    public Address(String city) {
        this.city = city;
    }

    @Override
    protected Object clone() throws CloneNotSupportedException {
        return new Address(this.city); // æ·±å…‹éš† Address
    }
}

class Person implements Cloneable {
    String name;
    Address address;

    public Person(String name, Address address) {
        this.name = name;
        this.address = address;
    }

    @Override
    protected Object clone() throws CloneNotSupportedException {
        Person clone = (Person) super.clone();
        clone.address = (Address) this.address.clone(); // æ‰‹åŠ¨æ·±å…‹éš†å¼•ç”¨å¯¹è±¡
        return clone;
    }
}

public class DeepCopyDemo {
    public static void main(String[] args) throws CloneNotSupportedException {
        Address addr = new Address("åŒ—äº¬");
        Person p1 = new Person("å¼ ä¸‰", addr);
        Person p2 = (Person) p1.clone();

        // ä¿®æ”¹åŸå§‹åœ°å€
        p1.address.city = "ä¸Šæµ·";

        System.out.println(p2.address.city); // è¾“å‡ºï¼šåŒ—äº¬ â† å› ä¸ºæ˜¯ä¸¤ä¸ªä¸åŒçš„ Address å¯¹è±¡
    }
}
```

### âœ… æ€»ç»“å¯¹æ¯”ï¼š

| ç±»å‹ | ç‰¹ç‚¹ | æ˜¯å¦å¤åˆ¶å†…éƒ¨å¯¹è±¡ |
|------|------|------------------|
| æµ…å…‹éš† | åªå¤åˆ¶å¯¹è±¡è‡ªå·± | âŒ ä¸å¤åˆ¶å¼•ç”¨å¯¹è±¡ |
| æ·±å…‹éš† | å¤åˆ¶å¯¹è±¡åŠå…¶æ‰€æœ‰å†…éƒ¨å¯¹è±¡ | âœ… å®Œå…¨ç‹¬ç«‹ |

---















å¤ªæ£’äº†ï¼Œä½ é—®äº†ä¸€ä¸ªéå¸¸å…³é”®çš„é—®é¢˜ï¼ğŸ‘

> **â€œä¸ºä»€ä¹ˆè¦é‡å†™ Java è‡ªå¸¦çš„ `Object` çš„ `clone()` æ–¹æ³•ï¼Ÿâ€**

è¿™ä¸ªé—®é¢˜å…¶å®æ¶‰åŠåˆ° Java é¢å‘å¯¹è±¡çš„æ ¸å¿ƒæ€æƒ³ä¹‹ä¸€ï¼š**å°è£…æ€§ + å¯æ‰©å±•æ€§**ã€‚

ä¸‹é¢æˆ‘ä¼šç”¨**ç®€å•æ˜“æ‡‚çš„è¯­è¨€ + ä¾‹å­**æ¥ä¸€æ­¥æ­¥è§£é‡Šæ¸…æ¥šï¼š

---

## ğŸ§  ä¸€ã€å…ˆå›é¡¾ä¸€ä¸‹ clone() æ˜¯ä»€ä¹ˆï¼Ÿ

Java ä¸­çš„æ¯ä¸ªç±»éƒ½ç»§æ‰¿è‡ª `Object` ç±»ï¼Œæ‰€ä»¥æ‰€æœ‰å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªé»˜è®¤çš„ `clone()` æ–¹æ³•ï¼š

```java
protected native Object clone() throws CloneNotSupportedException;
```

è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯ï¼š**å¤åˆ¶å½“å‰å¯¹è±¡ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„å‰¯æœ¬ã€‚**

ä½†å®ƒæœ‰å‡ ç‚¹é—®é¢˜ï¼š

| é—®é¢˜ | è¯´æ˜ |
|------|------|
| æƒé™æ˜¯ `protected` | å¤–éƒ¨ä¸èƒ½ç›´æ¥è°ƒç”¨ |
| è¿”å›ç±»å‹æ˜¯ `Object` | éœ€è¦å¼ºåˆ¶è½¬æ¢æˆå…·ä½“ç±»å‹ |
| æŠ›å‡ºå¼‚å¸¸ | è°ƒç”¨æ—¶å¿…é¡»å¤„ç†å¼‚å¸¸ |

---

## âœ… äºŒã€ä¸ºä»€ä¹ˆè¦é‡å†™ clone()ï¼Ÿï¼ˆä¸€å¥è¯æ€»ç»“ï¼‰

> **ä¸ºäº†è®© clone() æ›´å¥½ç”¨ã€æ›´å®‰å…¨ã€æ›´ç¬¦åˆé¢å‘å¯¹è±¡çš„è®¾è®¡ã€‚**

æˆ‘ä»¬é€šè¿‡å‡ ä¸ªå°ç›®æ ‡æ¥ç†è§£ï¼š

---

### ğŸ”¹ ç›®æ ‡ 1ï¼šè®© `clone()` æ–¹æ³•å¯ä»¥è¢«å¤–éƒ¨ç›´æ¥è°ƒç”¨

åŸå§‹çš„ `clone()` æ˜¯ `protected`ï¼Œåªèƒ½åœ¨æœ¬ç±»æˆ–å­ç±»ä¸­ä½¿ç”¨ã€‚

æˆ‘ä»¬æŠŠå®ƒæ”¹æˆ `public`ï¼Œè¿™æ ·åˆ«äººå°±èƒ½è°ƒç”¨äº†ï¼

```java
@Override
public Object clone() throws CloneNotSupportedException {
    return super.clone();
}
```

---

### ğŸ”¹ ç›®æ ‡ 2ï¼šè¿”å›å€¼æ›´æ˜ç¡®ï¼ˆä¸ç”¨æ¯æ¬¡éƒ½è¦å¼ºè½¬ï¼‰

ç°åœ¨è¿”å›çš„æ˜¯ `Object`ï¼Œè°ƒç”¨çš„æ—¶å€™è¦å¼ºè½¬ï¼š

```java
Person p2 = (Person) p1.clone(); // å¾ˆéº»çƒ¦
```

æˆ‘ä»¬å¯ä»¥æ”¹å†™ä¸ºè¿”å›å…·ä½“çš„ç±»å‹ï¼ˆä» Java 5 å¼€å§‹æ”¯æŒåå˜è¿”å›ç±»å‹ï¼‰ï¼š

```java
@Override
public Person clone() throws CloneNotSupportedException {
    return (Person) super.clone(); // è¿”å› Person ç±»å‹
}
```

è°ƒç”¨å°±æ–¹ä¾¿äº†ï¼š

```java
Person p2 = p1.clone(); // ä¸éœ€è¦å¼ºè½¬äº†
```

---

### ğŸ”¹ ç›®æ ‡ 3ï¼šå¤„ç†æ·±å…‹éš†é€»è¾‘ï¼ˆå¦‚æœéœ€è¦ï¼‰

é»˜è®¤çš„ `clone()` æ˜¯æµ…å…‹éš†ï¼Œå¦‚æœä½ çš„å¯¹è±¡é‡Œè¿˜æœ‰å…¶ä»–å¯¹è±¡å±æ€§ï¼ˆæ¯”å¦‚ `Address address`ï¼‰ï¼Œä½ éœ€è¦æ‰‹åŠ¨å¤åˆ¶å®ƒä»¬ï¼š

```java
@Override
public Person clone() throws CloneNotSupportedException {
    Person copy = (Person) super.clone();
    copy.address = this.address.clone(); // æ‰‹åŠ¨æ·±å…‹éš† address
    return copy;
}
```

---

### ğŸ”¹ ç›®æ ‡ 4ï¼šç®€åŒ–è°ƒç”¨è€…ä»£ç ï¼ˆé¿å…å¼‚å¸¸å¤„ç†æ··ä¹±ï¼‰

è™½ç„¶ `clone()` å¿…é¡»å£°æ˜ `throws CloneNotSupportedException`ï¼Œä½†ä½ å¯ä»¥è‡ªå·±å¤„ç†æ‰å®ƒï¼š

```java
@Override
public Person clone() {
    try {
        return (Person) super.clone();
    } catch (CloneNotSupportedException e) {
        // è¿™ä¸ªå¼‚å¸¸ç†è®ºä¸Šä¸ä¼šå‘ç”Ÿï¼Œå› ä¸ºæˆ‘ä»¬å®ç°äº† Cloneable
        throw new RuntimeException("å…‹éš†å¤±è´¥", e);
    }
}
```

è¿™æ ·è°ƒç”¨è€…å°±ä¸éœ€è¦å†™ `try-catch` äº†ï¼š

```java
Person p2 = p1.clone(); // æ²¡æœ‰å¼‚å¸¸å¤„ç†è´Ÿæ‹…
```

---

## âœ… ä¸‰ã€æ€»ç»“ï¼šä¸ºä»€ä¹ˆè¦é‡å†™ clone()

| åŸå§‹ clone() çš„é—®é¢˜ | æˆ‘ä»¬æ€ä¹ˆè§£å†³ï¼ˆä¸ºä»€ä¹ˆè¦é‡å†™ï¼‰ |
|---------------------|------------------------------|
| æ˜¯ protected æ–¹æ³• | æ”¹æˆ publicï¼Œè®©å¤–éƒ¨èƒ½è°ƒç”¨ |
| è¿”å› Object ç±»å‹ | æ”¹æˆå…·ä½“ç±»å‹ï¼Œå‡å°‘å¼ºè½¬ |
| éœ€è¦å¤„ç†å¼‚å¸¸ | å¯ä»¥å†…éƒ¨æ•è·å¹¶æŠ›è¿è¡Œæ—¶å¼‚å¸¸ |
| é»˜è®¤æ˜¯æµ…å…‹éš† | å¯ä»¥åŠ å…¥æ·±å…‹éš†é€»è¾‘ |
| ä¸ç¬¦åˆå°è£…åŸåˆ™ | æä¾›æ›´å‹å¥½çš„ API æ¥å£ |

---

## ğŸ“Œ å››ã€ä¸¾ä¸ªå®Œæ•´ä¾‹å­ï¼šé‡å†™çš„ clone()

```java
class Address implements Cloneable {
    String city;

    public Address(String city) {
        this.city = city;
    }

    @Override
    public Address clone() {
        try {
            return (Address) super.clone();
        } catch (CloneNotSupportedException e) {
            throw new RuntimeException(e);
        }
    }
}

class Person implements Cloneable {
    String name;
    Address address;

    public Person(String name, Address address) {
        this.name = name;
        this.address = address;
    }

    // é‡å†™ clone()ï¼špublic + å…·ä½“è¿”å›ç±»å‹ + æ·±å…‹éš†é€»è¾‘
    @Override
    public Person clone() {
        try {
            Person copy = (Person) super.clone();
            copy.address = this.address.clone(); // æ·±å…‹éš†
            return copy;
        } catch (CloneNotSupportedException e) {
            throw new RuntimeException("å…‹éš†å¤±è´¥", e);
        }
    }
}

public class Test {
    public static void main(String[] args) {
        Address addr = new Address("åŒ—äº¬");
        Person p1 = new Person("å¼ ä¸‰", addr);

        Person p2 = p1.clone(); // ç®€æ´è°ƒç”¨

        p1.address.city = "ä¸Šæµ·";
        System.out.println(p2.address.city); // è¾“å‡ºï¼šåŒ—äº¬ â† æ·±å…‹éš†ç”Ÿæ•ˆäº†
    }
}
```

---

## ğŸ¯ äº”ã€ä½ ç°åœ¨è¯¥æ€ä¹ˆåšï¼Ÿ

| å¦‚æœä½ æ˜¯åˆå­¦è€… | ğŸ‘‰ å…ˆäº†è§£ clone() æ˜¯å¹²å˜›çš„ï¼ŒçŸ¥é“å®ƒæ˜¯å¤åˆ¶å¯¹è±¡çš„ä¸€ç§æ–¹å¼ |
|----------------|----------------------------------------------------------|
| ä¸æƒ³æ·±å…¥ç»†èŠ‚   | ğŸ‘‰ è®°ä½æ¨¡æ¿å†™æ³•å³å¯ï¼Œä»¥åå†å­¦å¼‚å¸¸å’Œæ·±å…‹éš† |
| æƒ³å†™å‡ºæ›´å¥½ç”¨çš„ç±» | ğŸ‘‰ å­¦ä¼šé‡å†™ clone()ï¼Œè®©å®ƒæ›´å®‰å…¨ã€æ›´æ˜“ç”¨ |

---

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥å¸®ä½ ç”»ä¸€å¼ æµç¨‹å›¾æˆ–è€…åšä¸ªå­¦ä¹ æ¸…å•ï¼Œè®©ä½ æ›´å®¹æ˜“æŒæ¡è¿™äº›å†…å®¹ ğŸ˜Š